select empresa, cuenta, medidor, canton, parroquia, nombreabonado, ubicacionabonado from (select ROW_NUMBER() over (partition by a.cuenta,a.medidor order by  a.cuenta,a.medidor, similarity(a.ubicacionabonado,ao.ubicacionabonado) desc) as rowid, similarity(a.nombreabonado,ao.nombreabonado) as "abonadoS",  similarity(a.ubicacionabonado,ao.ubicacionabonado) as "ubicacionS", count(a.cuenta), e.empresa, e.canton, e.parroquia, a.cuenta, a.medidor, a.nombreabonado, a.ubicacionabonado, ao.nombreabonado as nombreabonadoOficial, ao.ubicacionabonado as ubicacionabonadoOficialfrom abonado a, abonado_oficial ao, empresa_ubicacion e 
where a.id_empresa_ubicacion = e.id_empresa_ubicacion and a.cuenta = ao.cuenta and a.id_empresa = ao.id_empresa and (catalina_full = 1 or cnel = 1) and a.id_abonado in (select distinct id_abonado from consumo where energia <> 0)
group by e.empresa, e.canton, e.parroquia, a.cuenta, a.medidor, a.nombreabonado, a.ubicacionabonado, ao.nombreabonado, ao.ubicacionabonado order by cuenta) as datos 
where datos.rowid = 1 group by empresa, cuenta, medidor, canton, parroquia, nombreabonado, ubicacionabonado order by empresa, canton, parroquia, cuenta, medidor, nombreabonado, ubicacionabonado
